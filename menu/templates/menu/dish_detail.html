{# E:\Rest_Project\menu\templates\menu\dish_detail.html #}
{% extends "core/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'menu/css/dish_detail.css' %}">
{% endblock %}

{% block content %}
<div class="dish-detail-container">
    <div class="dish-header">
        <div class="dish-images">
            <div class="main-image">
                {% if dish.image %}
                    <img src="{{ dish.image.url }}" alt="{{ dish.name }}" class="dish-main-photo">
                {% else %}
                    <img src="{% static 'menu/images/default_dish.jpg' %}" alt="{{ dish.name }}" class="dish-main-photo">
                {% endif %}
            </div>
        </div>
        
        <div class="dish-meta">
            <h1>{{ dish.name }}</h1>
            
            <div class="price-section">
                <span class="price">{{ dish.price }} ‚ÇΩ</span>
                {% if dish.old_price %}
                    <span class="old-price">{{ dish.old_price }} ‚ÇΩ</span>
                {% endif %}
            </div>
            
            <div class="dish-tags">
                {% if dish.is_vegan %}<span class="tag vegan">üå± –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ</span>{% endif %}
                {% if dish.is_spicy %}<span class="tag spicy">üå∂ –û—Å—Ç—Ä–æ–µ</span>{% endif %}
                {% if dish.is_chefs_choice %}<span class="tag chef">üë®‚Äçüç≥ –í—ã–±–æ—Ä —à–µ—Ñ–∞</span>{% endif %}
            </div>
        </div>
    </div>
    
    <div class="dish-content">
        {% if dish.description %}
        <div class="description-section">
            <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
            <p>{{ dish.description|linebreaks }}</p>
        </div>
        {% endif %}
        
        {% if dish.ingredients %}
<div class="ingredients-section">
    <h2>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h2>
    <ul class="ingredients-list">
        {% for ingredient in dish.ingredients.split %}
            <li>{{ ingredient }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}
    </div>
    
    {% if dish.gallery_items.exists %}
    <section class="dish-gallery-preview">
        <h2>–î—Ä—É–≥–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h2>
        <div class="preview-grid">
            {% for img in dish.gallery_items.all|slice:":3" %}
            <div class="gallery-item">
                <a href="{{ img.image.url }}" data-fancybox="dish-gallery">
                    <img src="{{ img.image.url }}" alt="{{ img.title }}" loading="lazy">
                </a>
            </div>
            {% endfor %}
        </div>
        <a href="{% url 'gallery:dish_gallery' dish.slug %}" class="btn view-all-btn">
            –í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ({{ dish.gallery_items.count }})
        </a>
    </section>
    {% endif %}
    
    {% if similar_dishes %}
    <div class="related-dishes">
        <h2>–ü–æ—Ö–æ–∂–∏–µ –±–ª—é–¥–∞</h2>
        <div class="related-grid">
            {% for related in similar_dishes %}
                <a href="{{ related.get_absolute_url }}" class="related-card">
                    {% if related.image %}
                        <img src="{{ related.image.url }}" alt="{{ related.name }}">
                    {% else %}
                        <img src="{% static 'menu/images/default_dish.jpg' %}" alt="{{ related.name }}">
                    {% endif %}
                    <h3>{{ related.name }}</h3>
                    <span class="price">{{ related.price }} ‚ÇΩ</span>
                </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'menu/js/dish_detail.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Fancybox –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
    Fancybox.bind("[data-fancybox='dish-gallery']", {
        Thumbs: {
            autoStart: true
        }
    });
});
</script>
{% endblock %}